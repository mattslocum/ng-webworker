/**
 * @license ng-webworker v0.2
 * (c) 2014-2015 Matt Slocum
 * License: MIT
 */
!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("ngWebworker",this,function(){"use strict";var a=angular.module("ngWebworker",[]),b="function",c="return",d="complete",e="notice";return a.provider("Webworker",function(){function a(a){function g(a,b){var c=function(){};b.external||!b.useHelper?this.oWorker=new Worker(a):(this.oWorker=new Worker(f.helperPath),this.strWorkerFunc=a),this.config=angular.extend({onMessage:c,onError:c,onReturn:c,onComplete:c,onNotice:c},b),b.onmessage&&(this.config.onMessage=b.onmessage,this.config.onError=b.onerror)}function h(a,b){var c=[];return b.config.transferOwnership&&!b.config.useHelper&&angular.forEach(a,function(a){a instanceof ArrayBuffer&&c.push(a)}),c}function complete(a){postMessage(["complete",a],_transferable_(a))}function notify(a){postMessage(["notice",a],_transferable_(a))}this.create=function(a,d){var e,h,i,j,k=window,l=k.URL||k.webkitURL,m=function(a){var b=[];return _async_||("[object Array]"!=toString.apply(a)&&(a=[a]),a.forEach(function(a){a instanceof ArrayBuffer&&b.push(a)})),b};if(d=d||{},d=angular.extend(angular.copy(f),d),(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&(d.useHelper=!0),Worker&&l&&l.createObjectURL&&(Blob||k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder))if(typeof a==b){d.external=!1,d.useHelper||(e=/function\s*(\w*)(.*)/.exec(a.toString()),e[1]=e[1]||"a",h="function "+e[1]+e[2],h+=a.toString().substring(e[0].length),h+=";onmessage=function(e){;var result = "+e[1]+".apply(null,e.data);postMessage(['"+c+"', result], _transferable_(result))};",h+="var _async_ = "+d.async+";"+m.toString(),typeof k.Blob===b?i=new Blob([complete,notify,h],{type:"application/javascript"}):(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)&&(k.BlobBuilder=k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder,i=new BlobBuilder,i.append(complete),i.append(notify),i.append(h),i=i.getBlob()));try{d.useHelper?(e=/function\s*(\w*)(.*)/.exec(a.toString()),e[1]=e[1]||"a",h="function "+e[1]+e[2],h+=a.toString().substring(e[0].length),j=new g(h,d)):j=new g(l.createObjectURL(i),d)}catch(n){}}else d.external=!0,j=new g(a,d);return j},g.prototype.run=function(){var b,f=a.defer(),g=this;return this.oWorker.onmessage=function(a){var b,h=a.data;g.config.external&&!g.config.async?f.resolve(h):(b=a.data.shift(),h=a.data[0],g.config.onMessage(a),b!=d&&b!=c&&f.notify(h),b==c?(g.config.async||f.resolve(h),g.config.onReturn(h)):b==d?(f.resolve(h),g.config.onComplete(h)):b==e&&g.config.onNotice(h))},this.oWorker.onerror=function(a){f.reject(a)},b=g.config.external||!g.config.useHelper?Array.prototype.slice.call(arguments):{fn:g.strWorkerFunc,args:Array.prototype.slice.call(arguments)},this.oWorker.postMessage(b,h(b,this)),g.config.external||g.config.useHelper||f.promise["finally"](function(){g.terminate()}),f.promise},g.prototype.stop=function(){this.oWorker.onerror(new Error("stopped")),this.terminate()},g.prototype.terminate=function(){this.oWorker.terminate()}}var f={async:!1,helperPath:"worker_wrapper.js",useHelper:!1,transferOwnership:!0};this.setConfig=function(a){angular.extend(f,a)},this.setHelperPath=function(a){f.helperPath=a},this.setUseHelper=function(a){f.useHelper=!!a},this.setTransferOwnership=function(a){f.transferOwnership=!!a},this.$get=["$q",function(b){return new a(b)}]}),a});