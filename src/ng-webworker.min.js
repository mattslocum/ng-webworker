/**
 * ng-webworker - ng-webworker creates dynamic webworkers so angular apps can be multi-threaded.
 * @version v0.2.4
 * @link https://github.com/mattslocum/ng-webworker
 * @license MIT
 */
!function(e,n,r){"undefined"!=typeof module&&module.exports?module.exports=r():"function"==typeof define&&define.amd?define(r):n[e]=r()}("ngWebworker",this,function(){"use strict";var e=angular.module("ngWebworker",[]),n="function",r="return",t="complete",o="notice";return e.provider("Webworker",function(){function e(e){function s(e,n){var r=function(){};n.external||!n.useHelper?this.oWorker=new Worker(e):(this.oWorker=new Worker(i.helperPath),this.strWorkerFunc=e),this.config=angular.extend({onMessage:r,onError:r,onReturn:r,onComplete:r,onNotice:r},n),n.onmessage&&(this.config.onMessage=n.onmessage,this.config.onError=n.onerror)}function a(e,n){var r=[];return n.config.transferOwnership&&!n.config.useHelper&&angular.forEach(e,function(e){e instanceof ArrayBuffer&&r.push(e)}),r}var l={};l._transferable_=function(e){var n=[];return"[object Array]"!=Object.prototype.toString.apply(e)&&(e=[e]),e.forEach(function(e){e instanceof ArrayBuffer&&n.push(e)}),n},l.complete=function(e){postMessage(["complete",e],self._transferable_(e))},l.notify=function(e){postMessage(["notice",e])},this.create=function(e,t){var o,a,f,c,u=window,p=u.URL||u.webkitURL;if(t=t||{},t=angular.extend(angular.copy(i),t),(-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Edge")||navigator.appVersion.indexOf("Trident/")>0)&&(t.useHelper=!0),Worker&&p&&p.createObjectURL&&(Blob||u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder))if(typeof e==n){t.external=!1,t.useHelper||(o=/function\s*(\w*)(.*)/.exec(e.toString()),o[1]=o[1]||"__user_func__",a="function "+o[1]+o[2],a+=e.toString().substring(o[0].length),a+=";onmessage=function(e){;var result = "+o[1]+".apply(null,e.data);postMessage(['"+r+"', result], !_async_ ? self._transferable_(result) : [])};",a+="var _async_ = "+t.async+";self._transferable_="+l._transferable_.toString()+";",u.Blob?f=new Blob(["self.complete="+l.complete.toString()+";","self.notify="+l.notify.toString()+";",a],{type:"application/javascript"}):(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)&&(u.BlobBuilder=u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder,f=new BlobBuilder,f.append("self.complete="+l.complete.toString()+";"),f.append("self.notify="+l.notify.toString()+";"),f.append(a),f=f.getBlob()));try{t.useHelper?(o=/function\s*(\w*)(.*)/.exec(e.toString()),o[1]=o[1]||"a",a="function "+o[1]+o[2],a+=e.toString().substring(o[0].length),c=new s(a,t)):c=new s(p.createObjectURL(f),t)}catch(g){}}else t.external=!0,c=new s(e,t);return c},s.prototype.run=function(){var n,i=e.defer(),s=this;return this.oWorker.onmessage=function(e){var n,a=e.data;s.config.external&&!s.config.async?i.resolve(a):(n=e.data.shift(),a=e.data[0],s.config.onMessage(e),n!=t&&n!=r&&i.notify(a),n==r?(s.config.async||i.resolve(a),s.config.onReturn(a)):n==t?(i.resolve(a),s.config.onComplete(a)):n==o&&s.config.onNotice(a))},this.oWorker.onerror=function(e){i.reject(e)},n=s.config.external||!s.config.useHelper?Array.prototype.slice.call(arguments):{fn:s.strWorkerFunc,args:Array.prototype.slice.call(arguments)},this.oWorker.postMessage(n,a(n,this)),s.config.external||s.config.useHelper||i.promise["finally"](function(){s.terminate()}),i.promise},s.prototype.stop=function(){this.oWorker.onerror(new Error("stopped")),this.terminate()},s.prototype.terminate=function(){this.oWorker.terminate()}}var i={async:!1,helperPath:"worker_wrapper.js",useHelper:!1,transferOwnership:!0};this.setConfig=function(e){angular.extend(i,e)},this.setHelperPath=function(e){i.helperPath=e},this.setUseHelper=function(e){i.useHelper=!!e},this.setTransferOwnership=function(e){i.transferOwnership=!!e},this.$get=["$q",function(n){return new e(n)}]}),e});